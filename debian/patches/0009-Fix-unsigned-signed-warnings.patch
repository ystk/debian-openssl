From 8ca79fcbf45ea2ed505679be20e1a8a4c3df07cf Mon Sep 17 00:00:00 2001
From: Matt Caswell <matt@openssl.org>
Date: Thu, 19 Mar 2015 11:35:33 +0000
Subject: [PATCH 09/12] Fix unsigned/signed warnings

Fix some unsigned/signed warnings introduced as part of the fix
for CVE-2015-0293

Reviewed-by: Tim Hudson <tjh@openssl.org>
Reviewed-by: Richard Levitte <levitte@openssl.org>
---
 ssl/s2_srvr.c | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

Index: openssl-0.9.8o/ssl/s2_srvr.c
===================================================================
--- openssl-0.9.8o.orig/ssl/s2_srvr.c	2015-03-20 21:19:37.000000000 +0000
+++ openssl-0.9.8o/ssl/s2_srvr.c	2015-03-20 21:20:19.396662316 +0000
@@ -363,7 +363,8 @@
 
 static int get_client_master_key(SSL *s)
 	{
-	int is_export,i,n,keya,ek;
+	int is_export,i,n,keya;
+        unsigned int ek;
 	unsigned long len;
 	unsigned char *p;
 	SSL_CIPHER *cp;
@@ -481,7 +482,7 @@
      * must be zero).
      */
     if ((!is_export && s->s2->tmp.clear != 0) ||
-        (is_export && s->s2->tmp.clear + ek != EVP_CIPHER_key_length(c))) {
+        (is_export && s->s2->tmp.clear + ek != (unsigned int)EVP_CIPHER_key_length(c))) {
         ssl2_return_error(s, SSL2_PE_UNDEFINED_ERROR);
         SSLerr(SSL_F_GET_CLIENT_MASTER_KEY,SSL_R_BAD_LENGTH);
         return -1;
@@ -492,7 +493,7 @@
      * bytes to fit the key in the buffer, stop now.
      */
     if ((is_export && s->s2->tmp.enc < ek) ||
-        (!is_export && s->s2->tmp.enc < EVP_CIPHER_key_length(c))) {
+        (!is_export && s->s2->tmp.enc < (unsigned int)EVP_CIPHER_key_length(c))) {
         ssl2_return_error(s,SSL2_PE_UNDEFINED_ERROR);
         SSLerr(SSL_F_GET_CLIENT_MASTER_KEY,SSL_R_LENGTH_TOO_SHORT);
         return -1;
@@ -509,7 +510,7 @@
 	/* If a bad decrypt, continue with protocol but with a
 	 * random master secret (Bleichenbacher attack) */
         if ((i < 0) || ((!is_export && i != EVP_CIPHER_key_length(c))
-                    || (is_export && i != ek)))
+                    || (is_export && i != (int)ek)))
 		{
 		ERR_clear_error();
 		if (is_export)
