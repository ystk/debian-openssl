From: Matt Caswell <matt@openssl.org>
Date: Mon, 23 Aug 2021 20:41:38 +0100
Subject: fixup! Fix i2v_GENERAL_NAME to not assume NUL terminated strings

---
 crypto/x509v3/v3_utl.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

Index: openssl1.0-1.0.2u/crypto/x509v3/v3_utl.c
===================================================================
--- openssl1.0-1.0.2u.orig/crypto/x509v3/v3_utl.c	2021-09-30 08:17:39.591887071 +0200
+++ openssl1.0-1.0.2u/crypto/x509v3/v3_utl.c	2021-09-30 08:17:39.587887075 +0200
@@ -87,9 +87,12 @@
     char *tname = NULL, *tvalue = NULL;
     if (name != NULL && !(tname = BUF_strdup(name)))
         goto err;
-    if (value != NULL) {
-        /* We don't allow embeded NUL characters */
-        if (memchr(value, 0, vallen) != NULL)
+    if (value != NULL && vallen > 0) {
+        /*
+         * We tolerate a single trailing NUL character, but otherwise no
+         * embedded NULs
+         */
+        if (memchr(value, 0, vallen - 1) != NULL)
             goto err;
         tvalue = BUF_strndup(value, vallen);
         if (tvalue == NULL)
